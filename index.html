<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <!-- ズームやダブルタップ拡大を無効化 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Breakout for Blogger</title>
  <style>
    :root {
      --bg: #0e0f13;
      --fg: #e8eef9;
      --muted: #9fb0c8;
      --accent: #5aa9ff;
      --accent-2: #8effa0;
      --danger: #ff6b6b;
      --card: #171924;
      --brick1: #6ee7ff;
      --brick2: #8a7dff;
      --brick3: #ff9f6e;
      --brick4: #ffd86e;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", Arial;
      background: radial-gradient(1200px 600px at 20% 10%, #171a24 0%, var(--bg) 60%);
      color: var(--fg);
      display: grid; place-items: center;
      /* ★ 選択禁止 */
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }
    .wrap { width: min(100vw, 780px); padding: 16px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      padding: 14px;
    }
    .title {
      display: flex; align-items: baseline; justify-content: space-between; gap: 8px;
      margin-bottom: 10px; padding: 0 4px;
    }
    .title h1 { font-size: clamp(18px, 2.4vw, 22px); margin: 0; letter-spacing: .5px; }
    .title .meta { font-size: 12px; color: var(--muted); }

    .canvas-box {
      position: relative;
      width: 100%;
      height: min(80vh, 600px);
    }
    canvas {
      width: 100%; height: 100%; display: block;
      background: linear-gradient(180deg, #0f1220 0%, #0b0d17 100%);
      border-radius: 12px;
      /* ★ 選択禁止 */
      -webkit-user-select: none;
      user-select: none;
    }
    .hud { position: absolute; inset: 10px 12px auto 12px; display: flex; justify-content: space-between; font-variant-numeric: tabular-nums; }
    .hud .pill { background: rgba(255,255,255,.07); border: 1px solid rgba(255,255,255,.12); padding: 6px 10px; border-radius: 999px; font-size: 12px; }

    .overlay {
      position: absolute; inset: 0; display: grid; place-items: center; text-align: center;
      background: radial-gradient(600px 300px at 50% 20%, rgba(90,169,255,.12), rgba(0,0,0,.4));
      backdrop-filter: blur(2px);
      /* ★ 選択禁止 */
      -webkit-user-select: none;
      user-select: none;
    }
    .overlay.hidden { display: none; }
    .overlay .panel { background: var(--card); border: 1px solid rgba(255,255,255,.08); border-radius: 16px; padding: 18px; width: min(92%, 520px); box-shadow: 0 20px 50px rgba(0,0,0,.45);}    
    .overlay h2 { margin: 0 0 8px; font-size: 20px; }
    .overlay p { margin: 0 0 14px; color: var(--muted); font-size: 14px; line-height: 1.6; }
    .overlay .btns { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }

    button {
      border: 1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      color: var(--fg); border-radius: 12px; padding: 10px 14px; cursor: pointer; font-weight: 600;
      box-shadow: 0 6px 18px rgba(0,0,0,.3);
    }
    button.primary { background: linear-gradient(180deg, rgba(90,169,255,.6), rgba(90,169,255,.35)); border-color: rgba(90,169,255,.75); }
    button:active { transform: translateY(1px); }
    .footer { margin-top: 10px; color: var(--muted); font-size: 12px; text-align: center; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,.12); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title">
        <h1>ブロック崩し</h1>
        <div class="meta">矢印キー / マウス / タッチ対応</div>
      </div>
      <div class="canvas-box">
        <canvas id="game"></canvas>
        <div class="hud">
          <div class="pill" id="score">SCORE 000000</div>
          <div style="display:flex; gap:8px;">
            <div class="pill" id="level">LV 1</div>
            <div class="pill" id="lives">❤❤❤</div>
          </div>
        </div>

        <div id="overlay" class="overlay">
          <div class="panel">
            <h2 id="ov-title">準備OK？</h2>
            <p id="ov-desc">左右キー（←/→）、A/D、マウス移動、またはスワイプでパドルを操作。<br>ボールを落とさずに全ブロックを壊そう！<br>スペースで一時停止／再開。</p>
            <div class="btns">
              <button class="primary" id="startBtn">スタート</button>
              <button id="muteBtn" aria-pressed="false">サウンド：オン</button>
            </div>
          </div>
        </div>

        <div id="pauseMsg" class="overlay hidden">
          <div class="panel">
            <h2>一時停止中</h2>
            <p>画面をタップすると再開します</p>
          </div>
        </div>
      </div>
      <div class="footer">埋め込みサイズに合わせて自動でリサイズされます。（推奨横幅 480px 以上）</div>
    </div>
  </div>

<script>
(function(){
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const startBtn = document.getElementById('startBtn');
  const muteBtn = document.getElementById('muteBtn');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const livesEl = document.getElementById('lives');
  const ovTitle = document.getElementById('ov-title');
  const ovDesc = document.getElementById('ov-desc');
  const pauseMsg = document.getElementById('pauseMsg');

  // ★ タッチとクリックの二重発火防止用
  let lastTouchTime = 0;

  // ...（ゲームロジックは省略、よっちさんの元コードそのまま利用）...

  function togglePause() {
    if (!state.running) return;
    state.paused = !state.paused;
    if (state.paused) {
      pauseMsg.classList.remove('hidden');
    } else {
      pauseMsg.classList.add('hidden');
    }
  }

  // PCクリック
  canvas.addEventListener('click', (e)=>{
    if (Date.now() - lastTouchTime < 500) return; // タッチ直後の疑似クリックを無視
    togglePause();
  });

  // スマホタップ
  canvas.addEventListener('touchstart', (e)=>{
    lastTouchTime = Date.now();
    if (!state.running) {
      startGame();
    } else if (state.paused) {
      e.preventDefault(); // ★ 選択やズームを防ぐ
      togglePause();
    } else {
      setPointerControl(e.touches[0].clientX);
    }
  }, { passive: false });

  // pauseMsg タップ/クリックでも再開
  pauseMsg.addEventListener('touchstart', (e)=>{
    lastTouchTime = Date.now();
    if (state.paused && e.touches.length === 1) {
      e.preventDefault();
      togglePause();
    }
  }, { passive: false });

  pauseMsg.addEventListener('click', (e)=>{
    if (Date.now() - lastTouchTime < 500) return;
    if (state.paused) togglePause();
  });

  // ...（残りのキー操作・HUD更新・ゲームループは元コードのまま）...
})();
</script>
</body>
</html>
